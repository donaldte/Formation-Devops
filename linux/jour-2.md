# üêß Cours Complet Linux pour DevOps

## Introduction

### Pourquoi Linux est incontournable pour le DevOps
- **97% des serveurs web** dans le monde utilisent Linux
- **Tous les outils DevOps majeurs** (Docker, Kubernetes, Jenkins, Terraform) fonctionnent sur Linux
- **Les conteneurs sont bas√©s sur Linux** - m√™me sous Windows/Mac, Docker utilise un noyau Linux virtualis√©

### R√¥le du shell (Bash/Zsh)
- Automatiser des t√¢ches r√©p√©titives
- Manipuler des fichiers et processus
- Superviser des services
- D√©ployer des applications

---

## 1. Structure du Syst√®me de Fichiers Linux

### Hi√©rarchie des r√©pertoires essentiels
```
/               ‚Üí Racine du syst√®me de fichiers
‚îú‚îÄ‚îÄ bin/        ‚Üí Commandes essentielles (ls, cp, mkdir...)
‚îú‚îÄ‚îÄ etc/        ‚Üí Fichiers de configuration syst√®me
‚îú‚îÄ‚îÄ home/       ‚Üí R√©pertoires personnels des utilisateurs
‚îú‚îÄ‚îÄ root/       ‚Üí R√©pertoire de l'administrateur
‚îú‚îÄ‚îÄ tmp/        ‚Üí Fichiers temporaires (effac√©s au red√©marrage)
‚îú‚îÄ‚îÄ usr/        ‚Üí Applications et programmes utilisateur
‚îú‚îÄ‚îÄ var/        ‚Üí Fichiers variables (logs, bases de donn√©es...)
‚îî‚îÄ‚îÄ lib/        ‚Üí Biblioth√®ques partag√©es essentielles
```

### Distributions Linux courantes en DevOps
1. **Ubuntu** - La plus populaire, excellente documentation
2. **CentOS/RHEL** - Standard en entreprise, tr√®s stable
3. **Debian** - Tr√®s stable, base d'Ubuntu
4. **Alpine Linux** - L√©g√®re, parfaite pour les conteneurs

---

## 2. Commandes Linux Essentielles

### 2.1 Navigation & gestion des fichiers
```bash
pwd          # Affiche le r√©pertoire courant
ls -la       # Liste les fichiers avec d√©tails et fichiers cach√©s
cd /chemin   # Change de r√©pertoire
tree         # Affiche l'arborescence (√† installer avec 'yum install tree' ou 'apt install tree')
```

### 2.2 Lecture et manipulation de fichiers
```bash
cat fichier.txt       # Affiche tout le contenu
less fichier.txt      # Affiche page par page (quitter avec 'q')
head -n 10 fichier.txt # Affiche les 10 premi√®res lignes
tail -f fichier.log   # Affiche la fin et suit les nouvelles entr√©es (logs en temps r√©el)
```

### 2.3 Cr√©ation, copie, suppression
```bash
touch nouveau.txt     # Cr√©e un fichier vide
mkdir nouveau_dossier # Cr√©e un dossier
cp source.txt dest/   # Copie un fichier
mv ancien.txt nouveau.txt # Renomme ou d√©place
rm fichier.txt        # Supprime (attention! pas de corbeille)
rm -r dossier/        # Supprime r√©cursivement
```

### 2.4 Recherche de fichiers et contenu
```bash
find /home -name "*.log"          # Trouve tous les fichiers .log dans /home
grep "ERROR" /var/log/syslog      # Cherche "ERROR" dans le fichier
grep -r "database" /etc/          # Recherche r√©cursive dans tous les fichiers
```

---

## 3. Gestion des Utilisateurs et Permissions

### Commandes essentielles
```bash
whoami        # Affiche l'utilisateur courant
id            # Affiche les informations de l'utilisateur
sudo commande # Ex√©cute une commande en tant que superutilisateur
```

### Gestion des permissions
```bash
chmod 755 script.sh    # Donne tous droits au propri√©taire, lecture/ex√©cution aux autres
chown user:group fichier # Change le propri√©taire et le groupe
```

#### Comprendre chmod (permissions Linux)
- **Lecture (r)** = 4
- **√âcriture (w)** = 2
- **Ex√©cution (x)** = 1

Exemple: `chmod 764 fichier`
- Propri√©taire: 7 (4+2+1 = rwx)
- Groupe: 6 (4+2 = rw-)
- Autres: 4 (r--)

---

## 4. Gestion des Processus et Services

### Surveillance des processus
```bash
ps aux                 # Liste tous les processus
top                    # Affiche les processus en temps r√©el (quitter avec 'q')
htop                   # Version am√©lior√©e de top (√† installer)
```

### Gestion des services avec systemctl
```bash
systemctl status nginx    # V√©rifie le statut du service
systemctl start nginx     # D√©marre le service
systemctl stop nginx      # Arr√™te le service
systemctl restart nginx   # Red√©marre le service
systemctl enable nginx    # Active le d√©marrage automatique
```

### Consultation des logs
```bash
journalctl -u nginx -f    # Affiche les logs de nginx en temps r√©el
tail -f /var/log/nginx/access.log # Suit les logs d'acc√®s nginx
```

---

## 5. R√©seau et Connectivit√©

### Commandes r√©seau essentielles
```bash
ping google.com          # Teste la connectivit√©
curl http://example.com  # T√©l√©charge ou teste une URL
wget http://example.com/file.zip # T√©l√©charge un fichier
```

### Analyse des ports et connexions
```bash
netstat -tuln            # Affiche les ports en √©coute
ss -tuln                 # Version moderne de netstat
```

### Transfert de fichiers et connexion distante
```bash
scp -i cl√©.pem fichier.local user@server:/distant/ # Copie s√©curis√©e
rsync -avz dossier/ user@server:/distant/          # Synchronisation efficace
ssh -i cl√©.pem user
```
scp -i "oui-front.pem" -r C:\Users\YourName\project-folder ubuntu@ec2-35-87-145-195.us-west-2.compute.amazonaws.com:/home/ubuntu/

scp -i "oui-front.pem" -r ubuntu@ec2-35-87-145-195.us-west-2.compute.amazonaws.com:/home/ubuntu/logs C:\Users\YourName\Downloads\

Chaque fichier/dossier a 3 types de permissions:
- **Lecture (r)** = 4 - Voir le contenu
- **√âcriture (w)** = 2 - Modifier/supprimer
- **Ex√©cution (x)** = 1 - Ex√©cuter (fichiers) ou traverser (dossiers)

Et 3 types d'utilisateurs:
- **Propri√©taire (u)** - User qui poss√®de le fichier
- **Groupe (g)** - Groupe propri√©taire du fichier
- **Autres (o)** - Tous les autres utilisateurs

### Commandes de gestion des permissions

```bash
# Afficher les permissions d√©taill√©es
ls -l fichier.txt
ls -ld dossier/    # Pour un dossier

# Changer les permissions avec chmod
chmod 755 fichier.txt          # Notation num√©rique
chmod u+rwx,g+rx,o+rx fichier.txt # Notation symbolique
chmod -R 755 dossier/          # R√©curssif pour un dossier

# Changer le propri√©taire et le groupe
chown utilisateur:fichier.txt  # Changer propri√©taire et groupe
chown utilisateur fichier.txt  # Changer seulement propri√©taire
chgrp groupe fichier.txt       # Changer seulement le groupe
```

### Masque umask
```bash
umask          # Affiche le masque courant (0022)
umask 002      # Change le masque
```
La permission r√©elle = permissions de base - umask

---

## 2. Gestion des Processus

### Visualisation des processus
```bash
ps aux                 # Tous les processus
ps -ef                 # Format √©tendu
top                    # Visualisation temps r√©el
htop                   # Version am√©lior√©e (√† installer)
pstree                 # Arbre des processus
```

### Gestion et suppression des processus
```bash
kill 1234              # Terminer le processus PID 1234
kill -9 1234           # Forcer la terminaison
killall nginx          # Terminer tous les processus nginx
pkill firefox          # Terminer par nom
nice -n 10 commande    # Lancer avec priorit√© basse
renice 15 -p 1234      # Changer la priorit√© d'un processus
```

### Processus en arri√®re-plan
```bash
commande &             # Lancer en arri√®re-plan
jobs                   # Lister les jobs en arri√®re-plan
fg %1                  # Ramener le job 1 au premier plan
bg %1                  # Remettre le job 1 en arri√®re-plan
ctrl + z               # Suspendre un processus au premier plan
```

---

## 3. Gestion des Utilisateurs et Groupes

### Cr√©ation et modification d'utilisateurs
```bash
# Cr√©er un utilisateur
sudo useradd -m -s /bin/bash nouvel_utilisateur
sudo passwd nouvel_utilisateur  # D√©finir le mot de passe

# Modifier un utilisateur
sudo usermod -aG sudo utilisateur  # Ajouter aux groupes sudo
sudo usermod -s /bin/sh utilisateur # Changer le shell
sudo usermod -L utilisateur        # Verrouiller le compte
sudo usermod -U utilisateur        # D√©verrouiller le compte

# Supprimer un utilisateur
sudo userdel -r utilisateur        # Supprimer avec son home directory
```

### Gestion des groupes
```bash
# Cr√©er et g√©rer les groupes
sudo groupadd dev_group           # Cr√©er un nouveau groupe
sudo groupmod -n new_name old_name # Renommer un groupe
sudo groupdel groupe_name         # Supprimer un groupe

# Ajouter/retirer des utilisateurs d'un groupe
sudo usermod -aG groupe utilisateur  # Ajouter au groupe
sudo gpasswd -d utilisateur groupe   # Retirer du groupe
```

### Fichiers de configuration importants
```bash
/etc/passwd    # Informations des utilisateurs
/etc/shadow    # Mots de passe chiffr√©s
/etc/group     # Informations des groupes
/etc/sudoers   # Configuration sudo
```

---

## 4. Exercices Pratiques

### Exercice 1: Gestion des Permissions

**Objectif**: Cr√©er une structure s√©curis√©e pour un projet d'√©quipe

```bash
# 1. Cr√©ez la structure suivante:
sudo mkdir -p /projet_equipe/{dev,prod,logs,backup}

# 2. Cr√©ez les groupes
sudo groupadd devs
sudo groupadd admins

# 3. Cr√©ez les utilisateurs
sudo useradd -m -G devs dev1
sudo useradd -m -G devs dev2
sudo useradd -m -G admins admin1

# 4. Configurez les permissions
sudo chown root:admins /projet_equipe
sudo chmod 775 /projet_equipe

sudo chown dev1:devs /projet_equipe/dev
sudo chmod 2770 /projet_equipe/dev  # sticky bit pour conservation groupe

sudo chown admin1:admins /projet_equipe/prod
sudo chmod 770 /projet_equipe/prod

# 5. Testez les acc√®s
sudo -u dev1 touch /projet_equipe/dev/test_dev1.txt
sudo -u dev2 touch /projet_equipe/dev/test_dev2.txt
sudo -u admin1 touch /projet_equipe/prod/test_admin.txt
```

### Exercice 2: Gestion des Processus

**Objectif**: Surveiller et g√©rer les processus syst√®me

```bash
# 1. Lancez quelques processus de test
sleep 300 &
tail -f /var/log/syslog &
nginx  # si install√©, ou utilisez un autre service

# 2. Identifiez les processus
ps aux | grep -E "sleep|tail|nginx"
pgrep sleep

# 3. Changez la priorit√© d'un processus
nice -n 15 sleep 200 &
renice 10 -p $(pgrep sleep)

# 4. Suspendre et reprendre un processus
# Trouvez un processus, suspendez-le avec Ctrl+Z, puis:
jobs
fg %1  # pour le ramener au premier plan
bg %1  # pour le remettre en arri√®re-plan

# 5. Terminez proprement les processus
pkill sleep
killall tail
```

### Exercice 3: Utilisateurs et Groupes Avanc√©s

**Objectif**: Configurer un environnement multi-utilisateurs avec permissions sp√©cifiques

```bash
# 1. Cr√©ez les groupes et utilisateurs
sudo groupadd developers
sudo groupadd auditors

sudo useradd -m -G developers alice
sudo useradd -m -G developers bob
sudo useradd -m -G auditors charlie

# 2. Cr√©ez la structure de directories
sudo mkdir -p /company/{projects,audit,shared}

# 3. Configurez les permissions avec ACL (Access Control Lists)
sudo setfacl -R -m g:developers:rwx /company/projects
sudo setfacl -R -m g:auditors:rx /company/projects
sudo setfacl -R -m g:auditors:rwx /company/audit
sudo setfacl -R -m g:developers:rwx /company/shared
sudo setfacl -R -m o::rx /company/shared

# 4. V√©rifiez les ACL
getfacl /company/projects

# 5. Testez avec diff√©rents utilisateurs
sudo -u alice touch /company/projects/alice_file.txt
sudo -u bob touch /company/projects/bob_file.txt
sudo -u charlie ls -la /company/projects/  # Doit pouvoir lire mais pas √©crire
```

### Exercice 4: Script de Surveillance Automatis√©e

**Objectif**: Cr√©er un script qui surveille les processus et envoie des alertes

```bash
#!/bin/bash
# surveillance-processus.sh

SERVICES=("nginx" "mysql" "ssh")

for service in "${SERVICES[@]}"; do
    if ! pgrep -x "$service" > /dev/null; then
        echo "ALERTE: Le service $service n'est pas en cours d'ex√©cution!"
        echo "$(date): Service $service arr√™t√©" >> /var/log/service_monitor.log
        # systemctl restart $service  # D√©commentez pour red√©marrer automatiquement
    fi
done

# Surveillance de l'utilisation m√©moire
MEM_USAGE=$(free | awk '/Mem:/ {printf("%.2f"), $3/$2 * 100}')
if (( $(echo "$MEM_USAGE > 90" | bc -l) )); then
    echo "ALERTE: Utilisation m√©moire √©lev√©e: $MEM_USAGE%"
    echo "$(date): M√©moire √©lev√©e: $MEM_USAGE%" >> /var/log/service_monitor.log
fi
```

### Exercice 5: Configuration Sudo Avanc√©e

**Objectif**: Donner des permissions sudo sp√©cifiques √† des utilisateurs

```bash
# 1. Cr√©ez un fichier de configuration sudo personnalis√©
sudo visudo -f /etc/sudoers.d/devops-permissions

# 2. Ajoutez ces lignes (d√©commentez et adaptez):
# %devops ALL=(ALL) NOPASSWD: /bin/systemctl restart nginx, /bin/systemctl status nginx
# alice ALL=(ALL) NOPASSWD: /usr/bin/apt update, /usr/bin/apt upgrade

# 3. Testez les permissions
sudo -u alice sudo apt update  # Devrait fonctionner sans mot de passe
sudo -u alice sudo reboot      # Devrait √©chouer (permission non accord√©e)
```

### Exercice 6: Gestion des Permissions avec ACL

**Objectif**: Utiliser les ACL pour des permissions avanc√©es

```bash
# 1. Installez les outils ACL si n√©cessaire
sudo apt install acl  # Debian/Ubuntu
sudo yum install acl  # CentOS/RHEL

# 2. Cr√©ez une structure de test
mkdir test_acl
touch test_acl/fichier.txt

# 3. Appliquez des ACL sp√©cifiques
setfacl -m u:alice:rwx test_acl/
setfacl -m g:developers:rx test_acl/
setfacl -m u:charlie:r-- test_acl/fichier.txt

# 4. V√©rifiez les ACL
getfacl test_acl/
getfacl test_acl/fichier.txt

# 5. Testez les permissions
sudo -u alice touch test_acl/test_alice.txt
sudo -u bob ls -la test_acl/      # Doit pouvoir lire
sudo -u charlie cat test_acl/fichier.txt  # Doit pouvoir lire
```

---

## 5. Bonnes Pratiques de S√©curit√©

1. **Principe du moindre privil√®ge**: Donnez seulement les permissions n√©cessaires
2. **Utilisez des groupes** pour g√©rer les permissions plut√¥t que des utilisateurs individuels
3. **Auditez r√©guli√®rement** les permissions avec `find / -perm -4000` pour trouver les SUID
4. **Utilisez les ACL** pour des besoins de permission complexes
5. **Journalisez les actions sudo** avec `sudo tail -f /var/log/auth.log`
6. **D√©sactivez les comptes inutilis√©s**
7. **Utilisez des mots de passe forts** et changez-les r√©guli√®rement

---

## 6. Commandes de V√©rification et Audit

```bash
# V√©rifier les derni√®res connexions
last
lastlog

# V√©rifier les tentatives de connexion √©chou√©es
sudo grep "Failed password" /var/log/auth.log

# Trouver les fichiers avec des permissions sp√©ciales
find / -perm -4000 2>/dev/null  # SUID files
find / -perm -2000 2>/dev/null  # SGID files

# V√©rifier les processus suspects
ps aux --sort=-%cpu | head -10  # Top 10 processus CPU
ps aux --sort=-%mem | head -10  # Top 10 processus m√©moire

# Audit des permissions
ls -la /etc/passwd /etc/shadow  # Doit √™tre root:root et 644/600
```

