aws code deploy 

ecrire du code: cloud9(VSC) 
manager et stocker le code: AWS CODE COMMIT(git et github)
build et le test: aws codebuild 
deploy: aws codedeploy(automatiser)
    ---> du travail 
    ---> error 
logging et le monitoring: cloudtrail et cloudwatch 
aws codepipeline

deploy/release ..........> EC2 ou lambda function

plusierus serveur (deployment group)





Pourquoi utiliser AWS CodeDeploy ? ü§î

AWS CodeDeploy est un service qui simplifie
 et automatise le d√©ploiement d'applications
  vers diff√©rents environnements. Comparons les
   m√©thodes de d√©ploiement manuelles, 
   bas√©es sur des scripts, et l'utilisation 
   d'AWS CodeDeploy.

1Ô∏è‚É£ D√©ploiement manuel (Manual Deployment) üõ†Ô∏è
Avec le manuel, vous d√©ployez directement 
sur le serveur (avec des commandes manuelles).
Inconv√©nients (Disadvantages) :

üïí Consomme du temps (time-consuming) : 
    Chaque √©tape doit √™tre r√©alis√©e √† la main.
‚ùå Source d'erreurs (error-prone) : 
    Les erreurs humaines sont fr√©quentes.
üåÄ Manque de coh√©rence (lack of consistency) :
     Le d√©ploiement peut varier d'un environnement √† l'autre.
‚ö° Utilisation inefficace des ressources (inefficient resource utilization) : 
    Le processus est peu optimis√©.
üìâ √âvolutivit√© limit√©e (limited scalability) :
     Difficile √† appliquer √† de nombreux serveurs.
üö´ Pas de m√©canisme de retour arri√®re (no rollback mechanism) : 
    Impossible d'annuler facilement un d√©ploiement 
    en cas de probl√®me.
    
2Ô∏è‚É£ D√©ploiement avec scripts (Script-based Deployment) üíª
Vous √©crivez du code pour automatiser le d√©ploiement.
Inconv√©nients (Disadvantages) :

‚úçÔ∏è √âcrire les scripts (write script) : 
    Cela demande du temps et des comp√©tences.
üß© Complexit√© (complexity) : 
    Plus l'application est grande, plus le script devient
     complexe.
‚ö†Ô∏è Gestion limit√©e des erreurs (limited error handling) :
     Les scripts ne g√®rent pas toujours bien les √©checs.
üåÄ Manque de coh√©rence (inconsistency) :
     Les r√©sultats peuvent varier selon l'environnement.
üö´ Pas de fonctionnalit√©s avanc√©es (lack of advanced features) : 
    Comme le basculement de trafic.
üìâ √âvolutivit√© limit√©e (limited scalability) :
     Pas id√©al pour de grandes infrastructures.
üîß Entretien lourd (maintenance overhead) : 
    Les scripts doivent √™tre constamment mis √† jour.

    
üåü Avantages d'AWS CodeDeploy üåü
Pourquoi choisir AWS CodeDeploy plut√¥t que d'autres outils ?

‚úÖ Supporte plusieurs types de d√©ploiements (Supports different types of deployment).
üõ†Ô∏è Facile √† int√©grer avec d'autres outils (Easy to work with other tools).
‚öôÔ∏è Configuration simple (Easy to setup).
üõ†Ô∏è Personnalisation (Allows customization of your deployment).
üîÑ Rollback facile (Rollback if something goes wrong).
‚è≥ Gain de temps (Saves time).
üîó Int√©gration fluide (Easy integration).
üåç D√©ploiement multi-environnements (Supports multiple environments: dev, test, prod).
üö¶ Basculement de trafic (Traffic shifting).
üí∞ √âconomique (Cost-effective).





üìã Strat√©gies de d√©ploiement (Deployment Strategies)

1Ô∏è‚É£ Blue/Green Deployment üö¶

Cr√©ation de deux environnements :
     l'ancien (blue) et le nouveau (green). 
     Une fois valid√©, le trafic est bascul√© 
     vers le nouvel environnement.


2Ô∏è‚É£ Rolling Deployment üîÑ

Mise √† jour progressive des serveurs en 
d√©ployant le code par lot.


3Ô∏è‚É£ Canary Deployment üê§

D√©ploiement sur une petite portion de serveurs 
pour tester avant un d√©ploiement complet.


4Ô∏è‚É£ Shadow Deployment üåò

D√©ploiement silencieux pour surveiller 
le comportement de la nouvelle version sans
 affecter les utilisateurs.


5Ô∏è‚É£ A/B Deployment üÖ∞Ô∏èüÖ±Ô∏è

Comparaison de deux versions de l'application 
pour √©valuer laquelle est la meilleure.

6Ô∏è‚É£ Continuous Deployment ‚ôæÔ∏è

Automatisation compl√®te : chaque changement valid√© dans
 le code est imm√©diatement d√©ploy√©.

7Ô∏è‚É£ In-Place Deployment üìç

Mise √† jour directe sur les serveurs existants 
sans cr√©er de nouvel environnement.




































AWS CodeDeploy est un service de d√©ploiement enti√®rement g√©r√© qui automatise
 le d√©ploiement des applications sur des plateformes vari√©es :

üíª Amazon EC2 (instances virtuelles).
üåê AWS Lambda (applications serverless).
üõ¢Ô∏è Amazon ECS (services conteneuris√©s).
üè† Serveurs locaux (On-premises).

L'objectif principal de CodeDeploy est d'assurer 
des d√©ploiements fiables, rapides, et sans interruption (z√©ro downtime).

Les Composants Essentiels d‚ÄôAWS CodeDeploy üîë
1. Application üèóÔ∏è
L'application repr√©sente le groupe logique des ressources que vous souhaitez d√©ployer.

Exemple : Une application web en Python/Django ou PHP pour un site e-commerce.
2. Plateforme de Calcul üíª
C‚Äôest la destination o√π votre application sera d√©ploy√©e. AWS CodeDeploy prend en charge les plateformes suivantes :

Amazon EC2 : Instances virtuelles.
AWS Lambda : Fonctionnalit√©s serverless.
Amazon ECS : Conteneurs (Docker ou Kubernetes).
Serveurs locaux (On-premises) : Vos propres serveurs physiques.

3. IAM Instance Profile üõ°Ô∏è
Le profil d‚Äôinstance IAM est un r√¥le attach√© aux instances EC2 ou serveurs locaux. Il permet √† CodeDeploy d'acc√©der aux ressources n√©cessaires pour g√©rer les d√©ploiements (par ex., r√©cup√©rer la r√©vision depuis S3).

Exemple : IAM role avec les permissions pour acc√©der √† des buckets S3 et logs CloudWatch.
4. Service Role üé©
Un r√¥le de service IAM donne √† AWS CodeDeploy les autorisations n√©cessaires pour effectuer des actions, telles que :

Mettre √† jour les instances EC2.
Modifier les services ECS.
Ex√©cuter des commandes sur des fonctions Lambda.
Exemple : R√¥le IAM avec la politique AWSCodeDeployRole.

5. Revision üì¶
C‚Äôest le contenu de d√©ploiement, c'est-√†-dire les fichiers qui d√©finissent ce qui doit √™tre d√©ploy√©. Les r√©visions peuvent inclure :

Code de l'application (ex. Python, Node.js).
Fichiers de configuration (JSON, YAML).
Scripts (ex. Bash).
Les r√©visions sont stock√©es dans :

Amazon S3.
GitHub ou un autre d√©p√¥t.
6. Target Revision üéØ
La r√©vision cible est la version sp√©cifique de votre application que vous souhaitez d√©ployer. Cela permet de d√©ployer des versions pr√©cises, comme v1.2.3.

7. Application Specification File üìÑ
Un AppSpec file est utilis√© pour d√©finir comment le d√©ploiement doit √™tre effectu√© sur chaque plateforme. Par exemple :

O√π copier les fichiers.
Quelles commandes ex√©cuter avant, pendant ou apr√®s le d√©ploiement.
Comment g√©rer les hooks de cycle de vie.
Format :

YAML pour EC2 et on-premises.
JSON pour AWS Lambda.
8. CodeDeploy Agent ü§ñ
L'agent CodeDeploy est un logiciel install√© sur des instances EC2 ou serveurs locaux. Il g√®re les √©tapes suivantes :

R√©cup√®re la r√©vision √† partir de S3/GitHub.
Ex√©cute les commandes d√©finies dans le fichier AppSpec.
Signale l‚Äô√©tat du d√©ploiement (r√©ussi ou √©chou√©).
9. Instance Health ‚ù§Ô∏è
L‚Äô√©tat de sant√© des instances est essentiel pendant un d√©ploiement. AWS CodeDeploy surveille les cibles pour s'assurer qu'elles sont fonctionnelles. Si une instance √©choue, le d√©ploiement peut √™tre annul√©.

Les Types de D√©ploiement üö¶
1. AllAtOnce üöÄ
Description : Toutes les cibles re√ßoivent la mise √† jour en m√™me temps.
Avantage : Rapide.
Inconv√©nient : Risque √©lev√© si le d√©ploiement √©choue.
Utilis√© avec : EC2, on-premises, Lambda.
2. Rolling üîÑ
Description : Mise √† jour progressive par petits groupes d'instances (ex. 25% √† la fois).
Avantage : Moins de risque d‚Äôinterruption.
Inconv√©nient : Plus lent que AllAtOnce.
Utilis√© avec : EC2, ECS.
3. Rolling with Additional Batch ‚ûï
Description : Ajoute une ou plusieurs instances suppl√©mentaires au pool avant de commencer le d√©ploiement, puis les retire √† la fin.
Avantage : Minimise les risques de surcharge.
Utilis√© avec : EC2, ECS.
4. Blue/Green üü¶üü©
Description : D√©ploie la nouvelle version dans un environnement distinct. Une fois valid√©e, le trafic est redirig√© vers la nouvelle version.
Avantage : Z√©ro interruption.
Inconv√©nient : Co√ªte plus cher.
Utilis√© avec : EC2, ECS, Lambda.
5. Canary üê¶
Description : D√©ploie sur un petit pourcentage d‚Äôinstances (ex. 10%) avant de d√©ployer sur le reste.
Avantage : Surveillance facile des probl√®mes.
Utilis√© avec : Lambda, ECS.
6. Linear üìä
Description : D√©ploie des lots d‚Äôinstances √† intervalles r√©guliers.
Avantage : Similaire √† Rolling mais avec un contr√¥le temporel.
Utilis√© avec : Lambda, ECS.
7. Immutable üõ°Ô∏è
Description : Cr√©e de nouvelles instances pour d√©ployer la mise √† jour, puis d√©truit les anciennes.
Avantage : Tr√®s s√©curis√©.
Utilis√© avec : EC2.
Quel Type de D√©ploiement pour Quel Serveur ?
Plateforme	D√©ploiement Recommand√©
EC2	Rolling, Immutable, Blue/Green
Lambda	Canary, AllAtOnce, Linear
ECS	Blue/Green, Rolling
On-premises	Rolling, AllAtOnce
Exemple de Sc√©nario Complet üåü
Sc√©nario 1 : D√©ploiement d'une Application Django
Plateforme : Instances EC2.
Fichiers n√©cessaires :
Code de l'application stock√© dans S3.
Fichier AppSpec (YAML) pour d√©finir le d√©ploiement.
Type de d√©ploiement : Rolling (25 % des instances √† la fois).
√âtapes :
Cr√©er un groupe de d√©ploiement avec les instances EC2 tagu√©es Environment=Production.
Configurer un r√¥le IAM avec acc√®s √† S3 et CodeDeploy.
Lancer le d√©ploiement via AWS CodeDeploy.
Questions pour R√©vision ‚ùì
Qu‚Äôest-ce qu‚Äôun IAM Instance Profile ?

R√©ponse : Un r√¥le IAM attach√© aux instances EC2 pour permettre l‚Äôacc√®s aux ressources (ex. S3).
√Ä quoi sert le fichier AppSpec ?

R√©ponse : D√©finir comment et o√π les fichiers doivent √™tre d√©ploy√©s, et quelles commandes ex√©cuter.
Quel type de d√©ploiement garantit z√©ro interruption ?

R√©ponse : Le d√©ploiement Blue/Green.
Quelles plateformes sont prises en charge par AWS CodeDeploy ?

R√©ponse : EC2, Lambda, ECS, on-premises.
Conclusion üåü
AWS CodeDeploy est un outil puissant pour automatiser les d√©ploiements.
Les r√¥les IAM, AppSpec files, et types de d√©ploiements doivent √™tre bien configur√©s.
Le choix du type de d√©ploiement d√©pend de la plateforme et de vos besoins en termes de disponibilit√©.





arn:aws:iam::148930418126:role/CodeDeployServiceRole


Dans cet exercice, vous allez configurer AWS CodeDeploy en effectuant les √©tapes suivantes :

Cr√©er un compte AWS avec des permissions limit√©es. acces programmatique(IAM)
Configurer un r√¥le de service pour CodeDeploy.
Restreindre les permissions attribu√©es √† CodeDeploy.

Cr√©er un profil d‚Äôinstance IAM pour Amazon EC2.

ec2 ----> s3 
s3 name: newbucketcodedeploy
arn:aws:s3:::newbucketcodedeploy
s3---->> creer policies -----> attacher cela a un role qui est attache au service ec2 













‚úîÔ∏è Cr√©ation d‚Äôun compte AWS avec un utilisateur IAM restreint.
‚úîÔ∏è Mise en place d‚Äôun r√¥le de service pour CodeDeploy.
‚úîÔ∏è Restriction des permissions accord√©es √† CodeDeploy.
‚úîÔ∏è Cr√©ation d‚Äôun profil d‚Äôinstance IAM pour EC2.

üí° Prochaines √©tapes :

Installer l‚Äôagent CodeDeploy sur l‚Äôinstance EC2.
D√©ployer une premi√®re application avec AWS CodeDeploy.























Configuration d'AWS CodeDeploy
1. Configuration du compte AWS
Assurez-vous de poss√©der un compte AWS et un utilisateur IAM avec des permissions administratives.
Activez l'acc√®s programmatique pour l'utilisateur IAM afin de permettre les interactions avec les services AWS via la CLI ou les SDKs.
2. Cr√©ation d'un r√¥le de service pour CodeDeploy
Un r√¥le de service est n√©cessaire pour accorder √† CodeDeploy les permissions requises pour effectuer des actions en votre nom.
Cr√©ez ce r√¥le via la console de gestion AWS, en sp√©cifiant CodeDeploy comme entit√© de confiance et en lui attribuant la politique g√©r√©e appropri√©e.
3. Limiter les permissions de l'utilisateur IAM
Restreignez les permissions de l'utilisateur IAM afin de minimiser les risques de s√©curit√© et d'emp√™cher les actions non autoris√©es.
D√©finissez les permissions n√©cessaires dans la politique IAM pour permettre uniquement les actions indispensables aux t√¢ches de CodeDeploy.
4. Cr√©ation d'un profil d'instance IAM pour les instances EC2 (si n√©cessaire)
Requis pour le d√©ploiement sur EC2 afin d'accorder aux instances l'acc√®s aux ressources AWS, telles que les buckets S3.
Cr√©ez un r√¥le IAM (profil d'instance) et attachez-lui des politiques permettant l'acc√®s aux ressources n√©cessaires.
5. Installation de l‚Äôagent CodeDeploy (si d√©ploiement sur EC2/serveurs sur site)
L‚Äôagent CodeDeploy est requis sur chaque instance EC2 ou serveur sur site du groupe de d√©ploiement.
Il coordonne avec le service CodeDeploy pour ex√©cuter les t√¢ches de d√©ploiement.
Composants d'AWS CodeDeploy
1. Application
Un conteneur ou un regroupement du logiciel √† d√©ployer, similaire √† l'organisation d'outils dans une bo√Æte √† outils.
2. Plateforme de calcul
La plateforme cible sur laquelle vous d√©ploierez votre application, incluant Amazon EC2, AWS Lambda, les serveurs sur site et Amazon ECS.
3. Configuration du d√©ploiement
Ensemble de r√®gles et param√®tres d√©finissant le processus de d√©ploiement, y compris la strat√©gie, l'environnement, le routage du trafic et la gestion des erreurs.
4. Groupe de d√©ploiement
Un ensemble de ressources (comme des instances EC2) cibl√©es pour le d√©ploiement. Il sp√©cifie o√π l‚Äôapplication sera d√©ploy√©e.
5. Type de d√©ploiement
La m√©thode de d√©ploiement, soit in-place (mise √† jour directe sur l‚Äôensemble des instances cibles), soit blue/green (cr√©ation d‚Äôun environnement dupliqu√© pour tests avant de rediriger le trafic).
6. Profil d'instance IAM
Un r√¥le IAM attach√© aux instances EC2, leur accordant les permissions n√©cessaires pour acc√©der aux ressources AWS durant le d√©ploiement.
7. R√©vision
La nouvelle version de votre application logicielle, packag√©e avec tous les fichiers et configurations n√©cessaires, pr√™te √† √™tre d√©ploy√©e.
8. R√¥le de service
Un r√¥le IAM sp√©cifique qui accorde √† CodeDeploy la permission d'acc√©der √† d'autres services AWS et d'ex√©cuter des t√¢ches li√©es au d√©ploiement.
9. R√©vision cible
La version la plus r√©cente de l'application que CodeDeploy va d√©ployer sur les instances sp√©cifi√©es.
10. Composants suppl√©mentaires
Fichiers de sp√©cification de l'application, √âtat de sant√© des instances, Agent CodeDeploy sont d'autres composants importants √† conna√Ætre pour g√©rer les d√©ploiements et r√©pondre aux besoins sp√©cifiques.
Bonnes pratiques et conseils
Comprendre les strat√©gies de d√©ploiement :
Choisissez la bonne strat√©gie de d√©ploiement (in-place ou blue/green) en fonction des besoins de votre application et de l'importance d'un service ininterrompu.
Automatiser et s√©curiser :
Utilisez des r√¥les IAM et des profils d'instance pour g√©rer l‚Äôacc√®s de mani√®re automatis√©e et s√©curis√©e.
Maintenez votre agent CodeDeploy √† jour pour garantir des performances et une s√©curit√© optimales.
Surveiller et journaliser :
Exploitez les services AWS comme CloudWatch pour surveiller les d√©ploiements et journaliser les activit√©s √† des fins de diagnostic et de r√©f√©rence future.
Pratiquer les retours en arri√®re :
Familiarisez-vous avec les fonctionnalit√©s de rollback de CodeDeploy afin de revenir rapidement √† une version pr√©c√©dente en cas d‚Äô√©chec du d√©ploiement.





















